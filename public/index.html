<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Servi√ßo Socket OEE</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="styles.css">
</head>


<body>
  <script src="socket.io/socket.io.js"></script>

  <button class="button1" type="button" id="ok">Simula Produto OK</button>
  <br>
  <br>
  <button class="button3" type="button" id="defeito">Simula Produto com Defeito</button>
  <br>
  <br>
  <button class="button2" type="button" id="stop">Simula Parada</button>
  <script type="text/javascript">
    window.onload = () => {
      const socket = io('http://localhost:3000')

      const btnOk = document.getElementById('ok')
      const btnDefeito = document.getElementById('defeito')
      const btnParada = document.getElementById('stop')

      socket.on('connect', () => {
        console.log(`Conectado: ${socket.id}`)
        socket.emit('teste', socket.id)

        btnOk.addEventListener('click', () => {
          console.log('produto OK')
          socket.emit('evento', {
            nome: 'Produto OK',
            valor: 72
          })
        })

        btnDefeito.addEventListener('click', () => {
          socket.emit('evento', {
            nome: 'Produto com Defeito',
            valor: 1
          })
          console.log('defeito')
        })

      })

      

      const dadosProducao = socket.on('producaoDados', (dadosRecebidos) => {
        return dadosRecebidos
      })
      console.log(dadosProducao)
      if (dadosProducao) {
        var quantidade = dadosProducao.qtd_produzida
        var id = dadosProducao.id 
      } else {
        var quantidade = socket.on('qtdProduzida', (valor) => {
        return valor
      })
      }

      var intervalo = 0
      var start
      btnParada.addEventListener('mousedown', () => {
        start = setInterval(function () {
          intervalo++
        }, 1000)
        console.log('Inicio parada')
      })
      btnParada.addEventListener('mouseup', () => {
        if (intervalo > 0) {
          socket.emit('evento', `Parada de ${intervalo} segundos registrada`)
        }
        console.log('Fim parada' + '   ' + intervalo)
        intervalo = 0
        clearInterval(start)
      })
    }
  </script>

</body>

</html>